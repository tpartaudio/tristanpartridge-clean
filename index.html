<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tristan Partridge - Music & Sound Design</title>
  <!-- Libraries -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
  <style>
    :root {
      --logo-height: 85px;
    }
    body {
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      background: #fff;
      color: #111;
      transition: all 0.6s;
      font-size: 16px; /* Prevent iOS zoom issues */
    }
    .nav-container {
      backdrop-filter: blur(60px) saturate(180%);
      background: rgba(255, 255, 255, 0.85);
      transition: transform 0.6s cubic-bezier(.22,1,.36,1);
      padding: 1.5rem 2rem;
    }
    .logo-container {
      position: absolute;
      left: 2rem;
      top: 1.5rem;
    }
    #logo {
      height: var(--logo-height);
      cursor: pointer;
      transition: transform .2s;
      transform: translateY(-18px);
    }
    #logo:hover { transform: scale(1.08) translateY(-18px); }
    .nav-links {
      position: relative;
      display: flex;
      gap: 40px;
      margin-left: auto;
    }
    .nav-link {
      font-weight: 600;
      padding: 8px 0;
      position: relative;
      z-index: 2;
    }
    .underline {
      position: absolute;
      bottom: 4px;
      left: 0;
      height: 2px;
      background: #000;
      transition: all .22s cubic-bezier(.4,0,.2,1);
    }
    .works-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }
    /* === DESKTOP GRID (UNCHANGED) === */
    .works-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 3rem;
    }
    .project-thumb {
      width: 100%;
      max-width: 320px;
      margin: 0 auto;
      aspect-ratio: 4/5;
      overflow: hidden;
      border-radius: 28px;
      cursor: pointer;
      box-shadow: 0 20px 50px rgba(0,0,0,0.18);
      background: #000;
      transition: transform .7s cubic-bezier(.22,1,.36,1), box-shadow .7s cubic-bezier(.22,1,.36,1);
    }
    .project-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform .9s cubic-bezier(.22,1,.36,1);
    }
    .project-thumb:hover {
      transform: translateY(-12px) scale(1.03);
      box-shadow: 0 60px 120px rgba(0,0,0,0.38);
    }
    .project-thumb:hover img {
      transform: scale(1.10);
    }
    .project-thumb.active {
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 30px 60px rgba(0,0,0,0.25);
    }

    /* === FIX HAMBURGER GLITCH === */
    #hamburger {
      position: absolute; /* Hides with nav-container */
      right: 2rem;
      top: 1.8rem; /* Aligned for visibility */
      z-index: 60;
      background: transparent;
      border: none;
    }
    #mobile-menu {
      transition: opacity 0.4s cubic-bezier(.22,1,.36,1), visibility 0.4s;
    }
    #mobile-menu.hidden {
      opacity: 0;
      visibility: hidden;
    }
    #mobile-menu:not(.hidden) {
      opacity: 1;
      visibility: visible;
    }

    /* === MOBILE ONLY (≤767px) === */
    @media (max-width: 767px) {
      /* --- NAV SECTION --- 
      Handles mobile nav bar padding, backdrop, and positioning. 
      Adjust padding or blur here for nav appearance. */
      .nav-container {
        padding: 2.2rem 1.5rem; /* Bigger menu bar */
        backdrop-filter: blur(20px) saturate(150%);
      }
      .logo-container {
        left: 1.5rem;
        top: 1.5rem;
      }
      #logo {
        height: 50px; /* Smaller logo */
        transform: translateY(0);
      }
      #logo:hover { transform: scale(1.05); }

      /* --- HAMBURGER SECTION --- 
      Controls the 3-line menu icon. 
      Thickness: span height 4px (thicker). 
      Adjust gap or width for size. */
      #hamburger {
        right: 1.5rem; /* Upper right corner */
        top: 2.5rem; /* Adjusted for bigger nav, upper position */
        padding: 0.5rem;
        width: 44px;
        height: 44px;
        display: flex !important; /* Force display */
        flex-direction: column;
        justify-content: center;
        gap: 6px;
        opacity: 1 !important; /* Force visibility */
        visibility: visible !important; /* Force visibility */
      }
      #hamburger span {
        height: 4px;
        width: 32px;
        background-color: #000 !important; /* Force black */
        transition: all 0.3s ease;
        opacity: 1 !important; /* Force lines visible */
      }

      /* --- MOBILE MENU SECTION --- 
      Manages the dropdown menu on hamburger click. 
      Adjust font-size, gap, or padding-top for layout. */
      #mobile-menu {
        padding-top: 6rem;
        gap: 2.5rem;
        font-size: 2rem;
        font-weight: 600;
      }
      #mobile-menu a {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.3s ease, transform 0.3s ease;
      }
      #mobile-menu:not(.hidden) a {
        opacity: 1;
        transform: translateY(0);
      }
      #mobile-menu a:nth-child(1) { transition-delay: 0.1s; }
      #mobile-menu a:nth-child(2) { transition-delay: 0.2s; }
      #mobile-menu a:nth-child(3) { transition-delay: 0.3s; }
      #mobile-menu a:active {
        transform: scale(0.95);
      }

      /* --- MAIN CONTENT SECTION --- 
      Sets padding for the main area to avoid overlap with nav. 
      Adjust pt (padding-top) if nav height changes. */
      main { padding-top: 6rem; /* Adjusted for bigger nav */ }

      /* --- GRID SECTION --- 
      Defines the project grid for mobile: single column. 
      Adjust gap for spacing between thumbs. */
      .works-container { padding: 0 1rem; }
      .works-grid {
        grid-template-columns: 1fr;
        gap: 2rem;
        padding: 0;
      }

      /* --- PROJECT THUMB SECTION --- 
      Styles individual project thumbnails. 
      Aspect-ratio 4/5. 
      Reduced size: max-width 80%, centered with auto margin. 
      Adjust border-radius or shadow for visual tweaks. */
      .project-thumb {
        max-width: 80%;
        margin: 0 auto;
        aspect-ratio: 4/5;
        border-radius: 20px;
        box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        transition: none !important; /* No animation */
      }
      .project-thumb:active, .project-thumb.active {
        transform: none !important; /* No change on tap or hold */
        box-shadow: 0 12px 30px rgba(0,0,0,0.15) !important;
      }
      .project-thumb img {
        border-radius: 20px;
        transition: none !important; /* No animation on img */
        transform: none !important; /* Static scale */
      }

      /* --- FOOTER SECTION --- 
      Social links at bottom. 
      Adjust gap or sizes for icons. */
      footer .flex {
        gap: 3rem;
      }
      footer img {
        width: 40px;
        height: 40px;
      }

      /* --- COPYRIGHT SECTION --- 
      Bottom copyright text. 
      Adjust position or font-size as needed. */
      #bottom-copyright {
        left: 1rem;
        bottom: 1rem;
        font-size: 10px;
      }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <!-- NAVBAR -->
  <nav class="nav-container fixed top-0 left-0 right-0 z-50 flex items-start justify-between">
    <div class="logo-container">
      <img id="logo" src="4.png" alt="logo" onclick="window.location.href='index.html'">
    </div>
    <div class="hidden md:flex nav-links text-lg font-medium">
      <a href="index.html" class="nav-link active" data-page="works">Works</a>
      <a href="about.html" class="nav-link" data-page="about">About</a>
      <a href="contact.html" class="nav-link" data-page="contact">Contact</a>
      <div class="underline" id="underline"></div>
    </div>
    <button id="hamburger" class="md:hidden space-y-2 z-50">
      <span class="block w-8 h-1 bg-black transition-all"></span>
      <span class="block w-8 h-1 bg-black transition-all"></span>
      <span class="block w-8 h-1 bg-black transition-all"></span>
    </button>
  </nav>

  <!-- MOBILE MENU -->
  <nav id="mobile-menu" class="fixed inset-0 bg-white hidden flex-col items-center justify-center gap-12 text-4xl z-40">
    <a href="index.html">Works</a>
    <a href="about.html">About</a>
    <a href="contact.html">Contact</a>
  </nav>

  <!-- CONTENT -->
  <main class="flex-1 pt-40">
    <div class="works-container">
      <div class="works-grid" id="projects"></div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="py-20 px-6 text-center">
    <div class="flex justify-center gap-12">
      <a href="https://www.instagram.com/tristanpartridge/" target="_blank">
        <img id="insta-logo" src="insta logo.png" class="w-11 h-11 hover:scale-110 transition">
      </a>
      <a href="https://www.behance.net/tristanpartrid1" target="_blank">
        <img id="behance-logo" src="behance logo.png" class="w-11 h-11 hover:scale-110 transition">
      </a>
    </div>
  </footer>

  <!-- SCRIPTS -->
  <script>
    gsap.registerPlugin(ScrollTrigger);
    const sound = new Howl({
      src: ["https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3"],
      volume: 0.3
    });

    // -----------------------------
    // LOAD CONFIG + ASSETS
    // -----------------------------
    fetch("config.json")
      .then(r => r.json())
      .then(cfg => {
        document.getElementById("logo").src = cfg.logo;
        document.getElementById("insta-logo").src = cfg.instagram_logo;
        document.getElementById("behance-logo").src = cfg.behance_logo;
      });

    // -----------------------------
    // LOAD PROJECTS + SMOOTH ANIMATION
    // -----------------------------
    fetch("works.json")
      .then(r => r.json())
      .then(projects => {
        const grid = document.getElementById("projects");
        const visible = projects.filter(p => !p.disabled);
        visible.forEach(p => {
          if (!p.thumb) return;
          const div = document.createElement("div");
          div.className = "project-thumb opacity-0 translate-y-16";
          div.innerHTML = `<img src="images/${p.thumb}" alt="${p.title}" loading="lazy">`;

          // Mobile tap handling to prevent accidental clicks during scroll or hold
          let touchStartY = 0;
          let touchStartTime = 0;
          div.addEventListener('touchstart', (e) => {
            touchStartY = e.touches[0].clientY;
            touchStartTime = Date.now();
            div.classList.add('active');
          });
          div.addEventListener('touchmove', (e) => {
            const touchMoveY = e.touches[0].clientY;
            if (Math.abs(touchMoveY - touchStartY) > 20) {
              div.classList.remove('active');
              e.preventDefault();
            }
          });
          div.addEventListener('touchend', (e) => {
            const touchEndY = e.changedTouches[0].clientY;
            const touchDuration = Date.now() - touchStartTime;
            if (Math.abs(touchEndY - touchStartY) <= 20 && touchDuration < 300) { // Short tap only, no hold
              setTimeout(() => {
                sessionStorage.setItem('scrollPosition', window.scrollY);
                window.location.href = p.video;
              }, 120);
            }
            div.classList.remove('active');
          });

          // Desktop click (unchanged)
          div.onclick = () => {
            sessionStorage.setItem('scrollPosition', window.scrollY);
            window.location.href = p.video;
          };

          grid.appendChild(div);
        });

        const scrollPosition = sessionStorage.getItem('scrollPosition');
        if (scrollPosition) {
          document.querySelectorAll('.project-thumb').forEach(el => {
            el.classList.remove('opacity-0', 'translate-y-16');
          });
          window.scrollTo({ top: parseInt(scrollPosition), behavior: 'instant' });
          sessionStorage.removeItem('scrollPosition');
        } else {
          gsap.fromTo(
            ".project-thumb",
            { opacity: 0, y: 70 },
            {
              opacity: 1,
              y: 0,
              duration: 0.55,
              ease: "power2.out",
              stagger: 0.08,
              scrollTrigger: {
                trigger: grid,
                start: "top 85%",
                toggleActions: "play none none none"
              }
            }
          );
        }
      });

    // -----------------------------
    // NAVBAR UNDERLINE ANIMATION
    // -----------------------------
    const underline = document.getElementById('underline');
    const links = document.querySelectorAll('.nav-link');
    let currentTarget = document.querySelector('[data-page="works"]') || links[0];
    links.forEach(l => l.classList.remove('active'));
    if (currentTarget) currentTarget.classList.add('active');

    function setUnderlineInstant(target) {
      if (!target || !underline) return;
      underline.style.transform = 'none';
      underline.style.transition = 'none';
      const linkRect = target.getBoundingClientRect();
      const containerRect = target.parentElement.getBoundingClientRect();
      underline.style.left = (linkRect.left - containerRect.left) + 'px';
      underline.style.width = linkRect.width + 'px';
      void underline.offsetHeight;
      underline.style.transition = '';
    }

    function moveUnderline(target, animate = true) {
      if (!target || !underline) return;
      gsap.set(underline, { clearProps: "transform, x, xPercent" });
      const linkRect = target.getBoundingClientRect();
      const containerRect = target.parentElement.getBoundingClientRect();
      const leftPx = linkRect.left - containerRect.left;
      const widthPx = linkRect.width;
      if (!animate) {
        underline.style.left = leftPx + 'px';
        underline.style.width = widthPx + 'px';
      } else {
        gsap.to(underline, {
          left: leftPx + 'px',
          width: widthPx,
          duration: 0.02,
          ease: "power2.out",
          overwrite: "auto"
        });
      }
    }

    window.addEventListener('load', () => {
      setUnderlineInstant(currentTarget);
      gsap.fromTo(underline,
        { scaleX: 0.98, transformOrigin: "center center" },
        {
          scaleX: 1,
          duration: 0.05,
          ease: "elastic.out(1, 0.5)",
          onComplete: () => gsap.set(underline, { clearProps: "transform, scaleX" })
        }
      );
    });

    links.forEach(link => {
      link.addEventListener('mouseenter', () => moveUnderline(link, true));
      link.addEventListener('mouseleave', () => moveUnderline(currentTarget, true));
      link.addEventListener('click', () => {
        links.forEach(l => l.classList.remove('active'));
        link.classList.add('active');
        currentTarget = link;
        setUnderlineInstant(currentTarget);
        sound.play();
      });
    });

    window.addEventListener('resize', () => {
      clearTimeout(window._navResizeTimer);
      window._navResizeTimer = setTimeout(() => setUnderlineInstant(currentTarget), 80);
    });

    // -----------------------------
    // MOBILE MENU + HAMBURGER FIX
    // -----------------------------
    const hamburger = document.getElementById("hamburger");
    const mobileMenu = document.getElementById("mobile-menu");

    hamburger.addEventListener("click", () => {
      mobileMenu.classList.toggle("hidden");
      sound.play();

      // Animation du hamburger → croix
      hamburger.classList.toggle("active");
      if (hamburger.classList.contains("active")) {
        gsap.to(hamburger.children[0], { rotate: 45, y: 10, duration: 0.3 });
        gsap.to(hamburger.children[1], { opacity: 0, duration: 0.3 });
        gsap.to(hamburger.children[2], { rotate: -45, y: -10, duration: 0.3 });
      } else {
        gsap.to(hamburger.children[0], { rotate: 0, y: 0, duration: 0.3 });
        gsap.to(hamburger.children[1], { opacity: 1, duration: 0.3 });
        gsap.to(hamburger.children[2], { rotate: 0, y: 0, duration: 0.3 });
      }
    });

    mobileMenu.addEventListener("click", (e) => {
      if (e.target.tagName === "A") {
        mobileMenu.classList.add("hidden");
        hamburger.classList.remove("active");
        gsap.to(hamburger.children[0], { rotate: 0, y: 0, duration: 0.3 });
        gsap.to(hamburger.children[1], { opacity: 1, duration: 0.3 });
        gsap.to(hamburger.children[2], { rotate: 0, y: 0, duration: 0.3 });
        sound.play();
      }
    });

    // -----------------------------
    // NAVBAR HIDE/SHOW ON SCROLL
    // -----------------------------
    let lastY = 0;
    const nav = document.querySelector(".nav-container");
    window.addEventListener("scroll", () => {
      const y = window.scrollY;
      const d = y - lastY;
      if (d > 8 && y > 100) {
        gsap.to(nav, { yPercent: -100, duration: 0.6, ease: "power4.out" });
      } else if (d < -8) {
        gsap.to(nav, { yPercent: 0, duration: 0.6, ease: "power4.out" });
      }
      lastY = y;
    });
  </script>

  <!-- Bottom-left copyright -->
  <div id="bottom-copyright" class="fixed bottom-6 left-8 text-xs text-gray-400 dark:text-gray-500 select-none font-light tracking-wider z-50 pointer-events-none" style="opacity:0 !important; visibility:hidden;">
    © <script>document.write(new Date().getFullYear())</script> Tristan Partridge
  </div>
  <script>
    (function () {
      const el = document.getElementById('bottom-copyright');
      let shown = false;
      const check = () => {
        const nearBottom = (window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 100);
        if (nearBottom && !shown) {
          shown = true;
          el.style.visibility = 'visible';
          gsap.to(el, { opacity: 1, duration: 0.8, ease: "power2.out" });
        } else if (!nearBottom && shown) {
          shown = false;
          gsap.to(el, {
            opacity: 0,
            duration: 0.1,
            ease: "power2.in",
            onComplete: () => el.style.visibility = 'hidden'
          });
        }
      };
      window.addEventListener('scroll', check);
      window.addEventListener('load', check);
      requestAnimationFrame(check);
    })();
  </script>
</body>
</html>